import pygame
import random
import time

# --- 1. Configurações Globais ---
pygame.init()

# Dimensões da tela
SCREEN_WIDTH = 600
SCREEN_HEIGHT = 600
SCREEN = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
pygame.display.set_caption("Snake Game (Pygame)")

# Cores
WHITE = (255, 255, 255)
GREEN = (0, 200, 0)
RED = (255, 0, 0)
BLACK = (0, 0, 0)

# Tamanho dos blocos (cobras e comida) e velocidade
BLOCK_SIZE = 20
FPS = 10 # Frames por segundo (controla a velocidade do jogo)

# Fonte para o placar
font = pygame.font.SysFont("arial", 25)

# Relógio para controlar o FPS
clock = pygame.time.Clock()

# --- 2. Funções de Desenho ---

def draw_snake(screen, snake_list):
    """Desenha a cobra na tela."""
    for x, y in snake_list:
        pygame.draw.rect(screen, GREEN, [x, y, BLOCK_SIZE, BLOCK_SIZE])

def draw_food(screen, food_pos):
    """Desenha a comida na tela."""
    pygame.draw.rect(screen, RED, [food_pos[0], food_pos[1], BLOCK_SIZE, BLOCK_SIZE])

def display_score(score):
    """Exibe o placar no canto superior esquerdo."""
    text = font.render("Pontos: " + str(score), True, BLACK)
    SCREEN.blit(text, [0, 0])

def generate_food(snake_list):
    """Gera uma nova posição para a comida, garantindo que não esteja sobre a cobra."""
    while True:
        # Posições aleatórias, ajustadas para o tamanho do bloco
        food_x = round(random.randrange(0, SCREEN_WIDTH - BLOCK_SIZE) / BLOCK_SIZE) * BLOCK_SIZE
        food_y = round(random.randrange(0, SCREEN_HEIGHT - BLOCK_SIZE) / BLOCK_SIZE) * BLOCK_SIZE
        food_pos = [food_x, food_y]
        
        # Verifica se a nova posição da comida está sobre a cobra
        if food_pos not in snake_list:
            return food_pos

# --- 3. Função Principal do Jogo ---

def game_loop():
    game_over = False
    game_close = False

    # Posição inicial da cobra (cabeça)
    x1 = SCREEN_WIDTH / 2
    y1 = SCREEN_HEIGHT / 2

    # Mudança de direção (começa parado ou movendo)
    x1_change = 0
    y1_change = 0

    # Lista para armazenar as coordenadas do corpo da cobra
    snake_list = []
    snake_length = 1
    score = 0

    # Gera a primeira comida
    food_pos = generate_food(snake_list)

    while not game_over:

        while game_close == True:
            SCREEN.fill(WHITE)
            message = font.render("Fim de Jogo! C-Recomeçar Q-Sair", True, RED)
            SCREEN.blit(message, [SCREEN_WIDTH / 6, SCREEN_HEIGHT / 3])
            display_score(score)
            pygame.display.update()

            for event in pygame.event.get():
                if event.type == pygame.QUIT:
                    game_over = True
                    game_close = False
                if event.type == pygame.KEYDOWN:
                    if event.key == pygame.K_q:
                        game_over = True
                        game_close = False
                    if event.key == pygame.K_c:
                        # Reinicia o jogo
                        game_loop()

        # --- Entrada do Usuário ---
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                game_over = True
            
            # Controle de direção da cobra
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_LEFT:
                    # Impede que a cobra vá diretamente para trás
                    if x1_change == 0:
                        x1_change = -BLOCK_SIZE
                        y1_change = 0
                elif event.key == pygame.K_RIGHT:
                    if x1_change == 0:
                        x1_change = BLOCK_SIZE
                        y1_change = 0
                elif event.key == pygame.K_UP:
                    if y1_change == 0:
                        y1_change = -BLOCK_SIZE
                        x1_change = 0
                elif event.key == pygame.K_DOWN:
                    if y1_change == 0:
                        y1_change = BLOCK_SIZE
                        x1_change = 0

        # --- Lógica do Jogo ---
        
        # 1. Checa Colisão com as Bordas
        if x1 >= SCREEN_WIDTH or x1 < 0 or y1 >= SCREEN_HEIGHT or y1 < 0:
            game_close = True

        # 2. Atualiza a Posição da Cabeça
        x1 += x1_change
        y1 += y1_change
        
        # --- Desenho na Tela ---
        SCREEN.fill(WHITE) # Limpa a tela
        
        draw_food(SCREEN, food_pos) # Desenha a comida

        # 3. Atualiza o Corpo da Cobra
        snake_head = [x1, y1]
        snake_list.append(snake_head)
        
        # Remove a cauda se a cobra não cresceu (mantendo o comprimento)
        if len(snake_list) > snake_length:
            del snake_list[0]

        # 4. Checa Colisão com o Próprio Corpo
        # O último elemento (cabeça) não é checado, por isso o slice [:-1]
        for x, y in snake_list[:-1]:
            if x == x1 and y == y1:
                game_close = True

        # 5. Checa Colisão com a Comida
        if x1 == food_pos[0] and y1 == food_pos[1]:
            food_pos = generate_food(snake_list) # Gera nova comida
            snake_length += 1 # Aumenta o comprimento (cresce)
            score += 10 # Aumenta a pontuação

        # Desenha a cobra e o placar
        draw_snake(SCREEN, snake_list)
        display_score(score)

        # Atualiza a tela
        pygame.display.update()

        # Controla a velocidade (FPS)
        clock.tick(FPS)

    pygame.quit()
    quit()

# --- 4. Inicia o Jogo ---
game_loop()